<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coach Sportif - Full Body & Split</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Theme: Slate / Blue / Emerald -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .chart-container {
      position: relative;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      height: 300px;
      max-height: 350px;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* Animations */
    @keyframes pulse-ring {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
      }

      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
      }
    }

    .timer-active {
      animation: pulse-ring 2s infinite;
    }

    .program-selector-btn.active {
      background-color: #1e293b;
      /* Slate-800 */
      color: white;
      border-color: #1e293b;
    }

    .program-selector-btn.inactive {
      background-color: white;
      color: #64748b;
      border-color: #e2e8f0;
    }

    /* Checkbox styling override */
    .custom-checkbox:checked {
      background-color: #2563eb;
      border-color: #2563eb;
    }
  </style>
  <!-- Application Structure Plan:
         1. Global Header: Program Selector (Full Body vs Split).
         2. Context Manager: JS Logic switches data sources and rendering functions based on selection.
         3. Dynamic Content Area: Renders either the "Single Page Full Body" flow or the "4-Day Tabbed" flow.
         4. Unified Footer: Global Timer and Progress bar working for both modes.
    -->
  <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>

<body class="bg-slate-50 text-slate-800 pb-32">

  <!-- GLOBAL HEADER & PROGRAM SELECTOR -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-4">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
          <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight">Mon <span class="text-blue-600">Coach</span>
          </h1>
          <p class="text-xs text-slate-400 font-medium uppercase tracking-wide">Application d'entra√Ænement unifi√©e</p>
        </div>

        <!-- Main Program Switcher -->
        <div class="flex bg-slate-100 p-1 rounded-xl w-full md:w-auto">
          <button onclick="switchProgram('fullbody')" id="btn-prog-fullbody"
            class="program-selector-btn active flex-1 md:flex-none px-6 py-2 rounded-lg text-sm font-bold transition-all shadow-sm">
            Full Body (1H)
          </button>
          <button onclick="switchProgram('split')" id="btn-prog-split"
            class="program-selector-btn inactive flex-1 md:flex-none px-6 py-2 rounded-lg text-sm font-bold transition-all hover:bg-white hover:shadow-sm">
            Split (4 Jours)
          </button>
        </div>
      </div>

      <!-- Sub-Navigation (Dynamic) -->
      <div id="sub-nav-container" class="mt-4 pt-2 border-t border-slate-100 hidden">
        <!-- Injected via JS based on program -->
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT AREA -->
  <main class="max-w-5xl mx-auto px-4 py-6 space-y-8 animate-fade-in">

    <!-- DASHBOARD SECTION (Charts & Info) -->
    <section id="dashboard-section" class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Dynamic Info Card -->
      <div class="md:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
        <div class="flex justify-between items-start mb-2">
          <h2 id="view-title" class="text-xl font-bold text-slate-800">Titre</h2>
          <span id="view-badge"
            class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold uppercase">Badge</span>
        </div>
        <p id="view-desc" class="text-slate-500 mb-6 text-sm leading-relaxed">Description...</p>

        <!-- Warmup Toggle (Visible only for Split) -->
        <div id="warmup-accordion" class="hidden bg-orange-50 border border-orange-100 rounded-xl overflow-hidden mt-4">
          <div class="p-3 cursor-pointer flex justify-between items-center hover:bg-orange-100 transition-colors"
            onclick="toggleElement('warmup-content')">
            <div class="flex items-center gap-2">
              <span class="text-orange-600 font-bold">üî• √âchauffement Requis</span>
            </div>
            <span class="text-orange-400 text-xs font-bold">VOIR ‚ñº</span>
          </div>
          <div id="warmup-content" class="px-4 pb-4 hidden border-t border-orange-100 pt-2">
            <ul id="warmup-list-split" class="list-disc list-inside text-sm text-orange-800 space-y-1"></ul>
          </div>
        </div>
      </div>

      <!-- Chart Card -->
      <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-center items-center">
        <h3 class="text-xs font-bold text-slate-400 uppercase mb-2 w-full text-center">Focus Musculaire</h3>
        <div class="chart-container">
          <canvas id="mainChart"></canvas>
        </div>
      </div>
    </section>

    <!-- WORKOUT CONTENT SECTION -->
    <section id="workout-container" class="space-y-6">
      <!-- Full Body specific list (Warmup phase) -->
      <div id="fullbody-warmup-section" class="hidden">
        <div class="flex items-center gap-3 mb-4">
          <div class="bg-emerald-100 text-emerald-600 p-2 rounded-lg font-bold">01</div>
          <h3 class="text-xl font-bold text-slate-800">√âchauffement Actif</h3>
        </div>
        <div id="fb-warmup-list"
          class="bg-white rounded-xl shadow-sm border border-slate-100 divide-y divide-slate-100"></div>
      </div>

      <!-- Main Exercises List (Used by both) -->
      <div id="main-exercise-header" class="hidden flex items-center gap-3 mb-4">
        <div class="bg-blue-100 text-blue-600 p-2 rounded-lg font-bold">02</div>
        <h3 class="text-xl font-bold text-slate-800">S√©ance</h3>
      </div>

      <div id="exercise-list" class="space-y-4">
        <!-- Cards injected here -->
      </div>

      <!-- Full Body Cool Down -->
      <div id="fullbody-cooldown" class="hidden mt-8">
        <div class="flex items-center gap-3 mb-4">
          <div class="bg-purple-100 text-purple-600 p-2 rounded-lg font-bold">03</div>
          <h3 class="text-xl font-bold text-slate-800">Retour au Calme</h3>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 text-sm text-slate-600">
          <ul class="list-disc list-inside space-y-2">
            <li>Suspension √† la barre (30s)</li>
            <li>√âtirements dynamiques l√©gers</li>
            <li>Respiration abdominale (2 min)</li>
          </ul>
        </div>
      </div>

      <!-- Abs Section (Split Only) -->
      <div id="abs-injector" class="hidden pt-6 border-t border-slate-200">
        <button onclick="toggleAbs()" id="btn-toggle-abs"
          class="w-full py-4 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 font-bold hover:border-blue-400 hover:text-blue-500 transition-all flex items-center justify-center gap-2">
          <span>+</span> Ajouter Circuit Abdos (Optionnel)
        </button>
        <div id="abs-content" class="hidden space-y-4 mt-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-bold text-slate-800 border-l-4 border-purple-500 pl-3">Circuit Abdominaux</h3>
            <button onclick="toggleAbs()" class="text-xs text-red-400 hover:text-red-600 font-bold">RETIRER ‚úï</button>
          </div>
          <div id="abs-list" class="space-y-4"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- UNIFIED FOOTER (Timer & Progress) -->
  <div
    class="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 shadow-[0_-5px_15px_-5px_rgba(0,0,0,0.1)] p-4 z-50">
    <div class="max-w-5xl mx-auto flex flex-col sm:flex-row gap-4 justify-between items-center">

      <!-- Progress -->
      <div class="w-full sm:w-1/3">
        <div class="flex justify-between text-xs font-bold text-slate-500 mb-1">
          <span>Progression S√©ance</span>
          <span id="progress-pct">0%</span>
        </div>
        <div class="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
          <div id="progress-bar" class="bg-blue-600 h-full rounded-full transition-all duration-500" style="width: 0%">
          </div>
        </div>
      </div>

      <!-- Timer Controls -->
      <div class="flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-end">
        <div id="timer-display"
          class="hidden bg-slate-800 text-white font-mono text-xl px-4 py-2 rounded-lg font-bold min-w-[90px] text-center shadow-lg transform -translate-y-1">
          00:00</div>

        <div class="flex gap-2 overflow-x-auto pb-1 sm:pb-0">
          <button onclick="startGlobalTimer(60)"
            class="whitespace-nowrap bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200 px-3 py-2 rounded-lg font-bold text-sm transition-colors">60s</button>
          <button onclick="startGlobalTimer(90)"
            class="whitespace-nowrap bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200 px-3 py-2 rounded-lg font-bold text-sm transition-colors">90s</button>
          <button onclick="startGlobalTimer(120)"
            class="whitespace-nowrap bg-slate-100 hover:bg-slate-200 text-slate-700 border border-slate-200 px-3 py-2 rounded-lg font-bold text-sm transition-colors">120s</button>
        </div>
      </div>

    </div>
  </div>

  <!-- JAVASCRIPT LOGIC -->
  <script>
    // --- DATA SOURCE ---

    // 1. Full Body Data
    const fullBodyData = {
      title: "S√©ance Full Body",
      desc: "Sollicitation globale du corps. Id√©al si vous ne pouvez vous entra√Æner que 2 √† 3 fois par semaine.",
      chart: [9, 8, 9, 6, 7, 5], // Legs, Back, Chest, Abs, Shoulders, Arms
      warmup: [
        { name: "Cardio L√©ger (Rameur/Elliptique)", info: "3 min" },
        { name: "Rotations Articulaires", info: "1 min" },
        { name: "Squats Poids du Corps", info: "15 reps" },
        { name: "Pompes (genoux ou classiques)", info: "10 reps" },
        { name: "Dislocations d'√©paules", info: "10 reps" }
      ],
      exercises: [
        { name: "Goblet Squat / Presse", muscle: "Jambes", sets: 3, reps: "10-12", rest: 90, note: "Dos droit, poussez sur les talons." },
        { name: "D√©velopp√© Couch√© (Halt√®res/Barre)", muscle: "Pecs", sets: 3, reps: "10-12", rest: 90, note: "Contr√¥lez la descente." },
        { name: "Tirage Vertical (Lat Pulldown)", muscle: "Dos", sets: 3, reps: "10-12", rest: 60, note: "Amenez la barre √† la poitrine." },
        { name: "Soulev√© de Terre Jambes Tendues", muscle: "Ischios", sets: 3, reps: "12-15", rest: 60, note: "Dos plat, fesses en arri√®re." },
        { name: "D√©velopp√© Militaire Assis", muscle: "√âpaules", sets: 3, reps: "12-15", rest: 60, note: "Pas de cambrure excessive." },
        { name: "Rowing Unilat√©ral", muscle: "Dos", sets: 3, reps: "12-15", rest: 60, note: "Tirage coude vers hanche." },
        { name: "Planche (Gainage)", muscle: "Abdos", sets: 3, reps: "45s", rest: 45, note: "Corps align√©." }
      ]
    };

    // 2. Split Data
    const splitProgram = {
      day1: {
        title: "Jour 1: Pectoraux, √âpaules & Triceps",
        desc: "S√©ance de pouss√©e (Push). Gros volume sur l'avant du corps.",
        chart: [2, 0, 9, 2, 8, 7], // Legs, Back, Chest, Abs, Shoulders, Arms
        warmup: ["√âlastiques Pectoraux", "2 s√©ries chauffe D√©velopp√© (40%/60%)"],
        exercises: [
          { name: "D√©velopp√© Inclin√© (Halt√®res/Barre)", muscle: "Pecs", sets: 3, reps: "8-12", rest: 105, note: "Banc √† 30¬∞" },
          { name: "√âcart√©s Poulie (Cable Fly)", muscle: "Pecs", sets: 3, reps: "8-15", rest: 90, note: "Focus contraction" },
          { name: "Chest Press Machine", muscle: "Pecs", sets: 2, reps: "8-15", rest: 90, note: "Finisher pecs" },
          { name: "√âl√©vations Lat√©rales", muscle: "√âpaules", sets: 3, reps: "8-15", rest: 90, note: "Contr√¥le strict" },
          { name: "Extensions Triceps Corde", muscle: "Bras", sets: 3, reps: "8-15", rest: 90, note: "Coudes fixes" },
          { name: "Extension Nuque Unilat√©rale", muscle: "Bras", sets: 2, reps: "8-15", rest: 90, note: "√âtirement triceps" }
        ]
      },
      day2: {
        title: "Jour 2: Dos & Biceps",
        desc: "S√©ance de tirage (Pull). Largeur et √©paisseur.",
        chart: [0, 10, 0, 0, 2, 8],
        warmup: ["Tirage Poitrine l√©ger (2 s√©ries)", "Repos court √©chauffement"],
        exercises: [
          { name: "Tirage Vertical (Lat Pulldown)", muscle: "Dos", sets: 3, reps: "8-12", rest: 120, note: "Grand dorsal" },
          { name: "Rowing (Halt√®re/Machine)", muscle: "Dos", sets: 3, reps: "8-12", rest: 90, note: "√âpaisseur" },
          { name: "Tirage Horizontal Serr√©", muscle: "Dos", sets: 2, reps: "8-15", rest: 90, note: "Bas du dos/Trap√®zes" },
          { name: "Curl Inclin√©", muscle: "Bras", sets: 3, reps: "8-12", rest: 90, note: "Biceps chef long" },
          { name: "Curl Pupitre (Larry Scott)", muscle: "Bras", sets: 3, reps: "8-15", rest: 90, note: "Isolation Biceps" }
        ]
      },
      day3: {
        title: "Jour 3: Jambes (Leg Day)",
        desc: "S√©ance compl√®te bas du corps. Intensit√© maximale.",
        chart: [10, 1, 0, 1, 0, 0],
        warmup: ["5 min V√©lo", "Mobilit√© Hanches", "Mont√©e en gamme Squat"],
        exercises: [
          { name: "Squat / Presse √† Cuisses", muscle: "Jambes", sets: 3, reps: "6-12", rest: 150, note: "Lourd et contr√¥l√©" },
          { name: "Soulev√© Terre Jambes Tendues", muscle: "Ischios", sets: 2, reps: "6-12", rest: 105, note: "Focus cha√Æne post√©rieure" },
          { name: "Fentes March√©es", muscle: "Jambes", sets: 2, reps: "20 pas", rest: 90, note: "Unilat√©ral" },
          { name: "Leg Curl Machine", muscle: "Ischios", sets: 3, reps: "8-15", rest: 90, note: "Flexion genou" },
          { name: "Leg Extension", muscle: "Quads", sets: 3, reps: "8-15", rest: 90, note: "Finisher Quadriceps" },
          { name: "Mollets Debout/Assis", muscle: "Mollets", sets: 3, reps: "15-20", rest: 60, note: "Optionnel" }
        ]
      },
      day4: {
        title: "Jour 4: Rappel Haut du Corps",
        desc: "Volume suppl√©mentaire pour le haut du corps.",
        chart: [2, 7, 7, 2, 6, 6],
        warmup: ["Mobilisation √âpaules", "Tirage l√©ger"],
        exercises: [
          { name: "Tirage Vertical", muscle: "Dos", sets: 3, reps: "8-12", rest: 90, note: "Largeur" },
          { name: "Tirage Horizontal", muscle: "Dos", sets: 2, reps: "8-15", rest: 90, note: "√âpaisseur" },
          { name: "D√©velopp√© Machine/Libre", muscle: "Pecs", sets: 3, reps: "8-12", rest: 90, note: "Masse globale" },
          { name: "Pec Fly", muscle: "Pecs", sets: 2, reps: "10-15", rest: 90, note: "Isolation" },
          { name: "Triceps Corde", muscle: "Bras", sets: 3, reps: "10-15", rest: 90, note: "Volume bras" },
          { name: "Oiseau Machine (Rear Delt)", muscle: "√âpaules", sets: 3, reps: "15-20", rest: 90, note: "Arri√®re d'√©paule" }
        ]
      },
      abs: [
        { name: "Relev√©s de Jambes", muscle: "Abdos", sets: 4, reps: "8-20", rest: 45, note: "Bassin d√©coll√©" },
        { name: "Crunch Poulie / D√©clin√©", muscle: "Abdos", sets: 4, reps: "8-20", rest: 45, note: "Contraction volontaire" }
      ]
    };

    // --- STATE ---
    let state = {
      program: 'fullbody', // 'fullbody' or 'split'
      splitDay: 'day1',    // 'day1', 'day2', 'day3', 'day4'
      absEnabled: false,
      totalSets: 0,
      setsDone: 0,
      timerId: null
    };

    let chartInstance = null;

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
      switchProgram('fullbody'); // Default load
    });

    // --- CORE FUNCTIONS ---

    function switchProgram(progType) {
      state.program = progType;
      state.absEnabled = false; // Reset abs
      state.setsDone = 0; // Reset progress visual (simple version)

      // UI Toggle
      const btnFB = document.getElementById('btn-prog-fullbody');
      const btnSP = document.getElementById('btn-prog-split');
      const subNav = document.getElementById('sub-nav-container');

      if (progType === 'fullbody') {
        btnFB.classList.replace('inactive', 'active');
        btnSP.classList.replace('active', 'inactive');
        subNav.classList.add('hidden');

        renderView(fullBodyData);

        // Specific Full Body UI elements
        document.getElementById('fullbody-warmup-section').classList.remove('hidden');
        document.getElementById('fullbody-cooldown').classList.remove('hidden');
        document.getElementById('warmup-accordion').classList.add('hidden'); // Split specific
        document.getElementById('abs-injector').classList.add('hidden'); // Split specific
        document.getElementById('main-exercise-header').classList.remove('hidden');

      } else {
        // SPLIT
        btnSP.classList.replace('inactive', 'active');
        btnFB.classList.replace('active', 'inactive');
        subNav.classList.remove('hidden');

        renderSplitNav();
        loadSplitDay(state.splitDay);

        // Specific Split UI elements
        document.getElementById('fullbody-warmup-section').classList.add('hidden');
        document.getElementById('fullbody-cooldown').classList.add('hidden');
        document.getElementById('warmup-accordion').classList.remove('hidden');
        document.getElementById('abs-injector').classList.remove('hidden');
        document.getElementById('main-exercise-header').classList.add('hidden'); // No separate header needed in split layout
      }
    }

    function renderSplitNav() {
      const days = [
        { id: 'day1', label: 'J1: Pecs/√âpaules' },
        { id: 'day2', label: 'J2: Dos/Biceps' },
        { id: 'day3', label: 'J3: Jambes' },
        { id: 'day4', label: 'J4: Haut Corps' }
      ];

      const html = days.map(d => `
                <button onclick="loadSplitDay('${d.id}')" id="nav-${d.id}" class="split-nav-btn text-xs font-bold px-3 py-1.5 rounded-full border transition-colors mr-2 mb-2 ${state.splitDay === d.id ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-500 border-slate-200 hover:border-blue-400'}">
                    ${d.label}
                </button>
            `).join('');

      document.getElementById('sub-nav-container').innerHTML = html;
    }

    function loadSplitDay(dayId) {
      state.splitDay = dayId;
      state.absEnabled = false; // Reset abs when changing days

      // Update Nav Styles
      document.querySelectorAll('.split-nav-btn').forEach(btn => {
        btn.className = 'split-nav-btn text-xs font-bold px-3 py-1.5 rounded-full border transition-colors mr-2 mb-2 bg-white text-slate-500 border-slate-200 hover:border-blue-400';
      });
      document.getElementById(`nav-${dayId}`).className = 'split-nav-btn text-xs font-bold px-3 py-1.5 rounded-full border transition-colors mr-2 mb-2 bg-blue-600 text-white border-blue-600';

      // Hide Abs UI
      document.getElementById('abs-content').classList.add('hidden');
      document.getElementById('btn-toggle-abs').classList.remove('hidden');
      document.getElementById('abs-list').innerHTML = '';

      renderView(splitProgram[dayId]);
    }

    function renderView(data) {
      // Text Content
      document.getElementById('view-title').textContent = data.title;
      document.getElementById('view-desc').textContent = data.desc;
      document.getElementById('view-badge').textContent = state.program === 'fullbody' ? 'Global' : 'Focalis√©';

      // Chart
      updateChart(data.chart);

      // Exercises
      const exContainer = document.getElementById('exercise-list');
      exContainer.innerHTML = '';

      data.exercises.forEach(ex => {
        exContainer.innerHTML += createExerciseCard(ex);
      });

      // Specific Warmup Rendering
      if (state.program === 'fullbody') {
        const fbWarmup = document.getElementById('fb-warmup-list');
        fbWarmup.innerHTML = fullBodyData.warmup.map(w => `
                     <div class="p-3 flex items-center justify-between hover:bg-slate-50">
                        <div>
                            <span class="font-bold text-slate-700 text-sm">${w.name}</span>
                            <span class="block text-xs text-slate-400">${w.info}</span>
                        </div>
                        <input type="checkbox" onchange="checkSet(this)" class="custom-checkbox w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                    </div>
                `).join('');
      } else {
        const splitWarmup = document.getElementById('warmup-list-split');
        splitWarmup.innerHTML = data.warmup.map(w => `<li>${w}</li>`).join('');
        document.getElementById('warmup-content').classList.add('hidden'); // Reset accordion
      }

      calculateTotals();
    }

    function createExerciseCard(ex) {
      let boxes = '';
      for (let i = 1; i <= ex.sets; i++) {
        boxes += `
                <div class="relative">
                    <input type="checkbox" onchange="checkSet(this)" class="custom-checkbox peer appearance-none w-10 h-10 border-2 border-slate-200 rounded-lg checked:bg-blue-600 checked:border-blue-600 transition-all cursor-pointer z-10 relative">
                    <span class="absolute inset-0 flex items-center justify-center text-slate-300 font-bold pointer-events-none peer-checked:text-white">${i}</span>
                </div>`;
      }

      return `
            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 transition-all hover:shadow-md">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <span class="inline-block px-2 py-0.5 rounded bg-slate-100 text-slate-500 text-[10px] font-bold uppercase mb-1 tracking-wide">${ex.muscle}</span>
                        <h4 class="font-bold text-slate-800 text-lg leading-tight">${ex.name}</h4>
                        <p class="text-xs text-slate-400 mt-1 italic">üí° ${ex.note}</p>
                    </div>
                    <div class="text-right pl-2">
                        <span class="block font-bold text-slate-700 text-lg">${ex.sets} x ${ex.reps}</span>
                        <button onclick="startGlobalTimer(${ex.rest})" class="mt-2 inline-flex items-center gap-1 text-xs font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded hover:bg-orange-100 transition-colors">
                            ‚è±Ô∏è ${ex.rest}s
                        </button>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 mt-2 pt-2 border-t border-slate-50">
                    ${boxes}
                </div>
            </div>
            `;
    }

    // --- ABS & EXTRAS ---
    function toggleAbs() {
      const container = document.getElementById('abs-content');
      const list = document.getElementById('abs-list');
      const btn = document.getElementById('btn-toggle-abs');

      if (!state.absEnabled) {
        // Enable
        state.absEnabled = true;
        list.innerHTML = '';
        splitProgram.abs.forEach(ex => {
          list.innerHTML += createExerciseCard(ex);
        });
        container.classList.remove('hidden');
        btn.classList.add('hidden');

        // Scroll
        setTimeout(() => {
          container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      } else {
        // Disable
        state.absEnabled = false;
        container.classList.add('hidden');
        btn.classList.remove('hidden');
        list.innerHTML = '';
      }
      calculateTotals();
    }

    function toggleElement(id) {
      document.getElementById(id).classList.toggle('hidden');
    }

    // --- PROGRESS & TIMER ---

    function calculateTotals() {
      // Count Checkboxes in DOM
      const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
      state.totalSets = allCheckboxes.length;

      const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
      state.setsDone = checkedBoxes.length;

      updateProgressBar();
    }

    function checkSet(el) {
      // Visual bounce if needed, handled by CSS mostly
      calculateTotals();
    }

    function updateProgressBar() {
      const pct = state.totalSets === 0 ? 0 : Math.round((state.setsDone / state.totalSets) * 100);
      document.getElementById('progress-bar').style.width = `${pct}%`;
      document.getElementById('progress-pct').innerText = `${pct}%`;

      if (pct === 100 && state.totalSets > 0) {
        document.getElementById('progress-pct').classList.add('text-emerald-500');
      }
    }

    function startGlobalTimer(seconds) {
      clearInterval(state.timerId);
      const display = document.getElementById('timer-display');

      display.classList.remove('hidden', 'bg-emerald-500');
      display.classList.add('bg-slate-800', 'timer-active');

      let timeLeft = seconds;
      display.innerText = formatTime(timeLeft);

      state.timerId = setInterval(() => {
        timeLeft--;
        display.innerText = formatTime(timeLeft);

        if (timeLeft <= 0) {
          clearInterval(state.timerId);
          display.innerText = "GO!";
          display.classList.remove('bg-slate-800', 'timer-active');
          display.classList.add('bg-emerald-500');

          setTimeout(() => display.classList.add('hidden'), 3000);
        }
      }, 1000);
    }

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec < 10 ? '0' : ''}${sec}`;
    }

    // --- CHART ---
    function updateChart(dataValues) {
      const ctx = document.getElementById('mainChart').getContext('2d');

      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['Jambes', 'Dos', 'Pecs', 'Abdos', '√âpaules', 'Bras'],
          datasets: [{
            label: 'Intensit√©',
            data: dataValues,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderColor: '#2563eb',
            pointBackgroundColor: '#2563eb',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              min: 0,
              max: 10,
              ticks: { display: false },
              pointLabels: {
                font: { size: 11, family: 'Inter' },
                color: '#64748b'
              },
              grid: { color: '#f1f5f9' }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    }
  </script>
</body>

</html>